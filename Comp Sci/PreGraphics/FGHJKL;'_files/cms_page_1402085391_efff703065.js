/* BEGIN HAIKU LICENSE
* (c) 2006-2012 HAIKU Learning Systems - http://www.haikulearning.com
*/
function add_content_tab_position(){try{var d=$("MD_box"),b=$("add_content_block_tabs"),e,a;if(b){d.style.visibility="hidden";e=b.getHeight();a=d.cumulativeOffset();e+=1;d.style.top=a[1]+e+"px";b.setStyle({top:-e+"px",left:"0px"});d.style.visibility="";add_content_preview();}}catch(c){}}function add_content_showtab(b,c){var a=$("add_content_block_dialog");a.select(".add_content_buttons").invoke("hide");$(c).show();add_content_preview();a.select(".tabmenu li").invoke("removeClassName","selected");$(b).addClassName("selected");}function show_hide_cms_box_ellipses(c){try{var b=$("box_"+c);if(b){b.select(".list_item").each(function(h){var f=h.select("span, a").inject(0,function(j,e){return j+e.offsetWidth;});try{var d=h.previous(".ellipse");if(d){d[f<b.offsetWidth-40?"hide":"show"]();}}catch(g){}});}}catch(a){}}function lightbox_popup(a,c,b){return generic_popup("lightbox_popups",a,c,b);}function resize_cms_box_embed(d,a){try{var b=Object.isUndefined(d)?$$(".widget_content"):[$(d)];if(Object.isUndefined(a)){a=true;}resize_cms_box_embed_counts=new Hash;b.each(function(h){var e=h.contentWindow,f=5,g=h.getHeight();resize_cms_box_embed_counts.set(h.id,0);new PeriodicalExecuter(function(i){try{if(e&&!e.document.loaded){return;}var l=resize_cms_box_embed_counts.get(h.id),j=l>f,m=e?(e.$(h.id).getHeight()+10):$(h.id).getHeight();resize_cms_box_embed_counts.set(h.id,l+1);if(j){i.stop();}else{if(m!=g){h.height=m;i.stop();}}}catch(k){i.stop();}},1);});}catch(c){}}DragTip={show:function(e){if(window.mobilecheck()){return;}var d=$("drag_tip_"+e),c=d.select("span.dragtip")[0],a=c.getWidth()+10,b=d.getWidth();if(d){d.select("span").each(function(f){if(!f.hasClassName("dragtip")){b-=f.getWidth();}});if(b>=a){c.show().setStyle({marginLeft:((b-a)/2)+1+"px"});}}},hide:function(b){var a=$("drag_tip_"+b);if(a){a.select("span.dragtip")[0].hide();}}};boxDel=function(f,c){var b="",a=_urlBoxDel.interpolate({cont:c,id:f}),d=$("box_"+f),e="<b>"+d.select("div.head span.box_title")[0].innerHTML+"</b>";if(c=="cms_box_assessment"){b=_msgBoxDelAsmt;}else{if(c=="cms_box_discussion"){b=_msgBoxDelDsc;}}b+=_msgBoxDel.interpolate({title:e});if(c=="cms_box_google_doc"){$("md_confirm_delete_gdoc").innerHTML=$("md_confirm_delete_gdoc_tpl").innerHTML.interpolate({title:e,id:f});return MD_show("md_confirm_delete_gdoc");}return MD_confirm(b,function(){boxDisable(d);ajax_post(a);});};boxDisable=function(a){a.addClassName("disabled");a.select("div.head a").each(function(b){b.onclick=function(){return false;};});};boxDelGdoc=function(d,b){var c=$("box_"+d),a=_urlBoxDel.interpolate({cont:"cms_box_google_doc",id:d});boxDisable(c);MD_remove();ajax_post(a+(b?"?delete_doc=1":""));};function boxEdit(g,d,f){var c=$(f.parentNode).select("span"),a=$("box_dmenu");a.innerHTML=$("box_dmenu_tpl").innerHTML.interpolate({id:g,cont:d,menu:c[0]?"<hr/>"+c[0].innerHTML:""});if(["cms_box_annc","cms_box_cldr","cms_box_cldr_list"].include(d)){a.select(".bshare").invoke("hide");}return DMenu.show("box_dmenu",f,{align:"right"});}function sidebarSel(b){var a=function(d){tgl("sm_"+d,"smi_"+d);var c=$("pagemenu_"+d).up().id.match(/\d+$/);if(c!=0){a(c[0]);}};$("plink_"+b).up().addClassName("selected");a(b);}CommentWriter={show:function(a,d,b){if(TBLite.isOpen()){if(!this.visible()){}else{if(this.element!=TBLite.window){}else{var c=this.element.down(".bdelete");c=c.readAttribute("replacemsg")+c.readAttribute("deletemsg");MD_confirm(c,function(){TBLite.remove();CommentWriter.show(a,d,b);});}}}tbOpts={overlay:false,disableMScroll:false,interpolate:b,position:{toString:function(){return"";},modifier:function(e){return Object.extend(e,{position:"fixed",top:null,zIndex:100});}},afterShow:function(){if(TBLite.isOpen()){CommentWriter.element=TBLite.window;CommentWriter.element.addClassName("page_comments_writer");}CommentWriter.resize();try{var e=TBLite.button;e=e.absoluteOffset()[1]+e.getHeight();e+=CommentWriter.element.getHeight()-document.viewport.getHeight();(function(){window.scroll(document.viewport.getScrollOffsets()[0],e);}).defer();}catch(f){jslog(f,"CommentWriter.tbOpts.afterShow");}try{$(d).onclick();}catch(f){}},beforeRemove:function(){CommentWriter.cleanup();}};TBLite.show(d,a,tbOpts);this.spacer().show();},element:null,visible:function(){return Object.isElement(this.element)&&this.element.visible();},form:function(){return this.visible()&&this.element.down("form");},spacer:function(){var b="comment_writer_spacer",a="";if(!$(b)){b=new Element("div",{id:b,style:"height:"+this.element.getHeight()+"px;"}).update("&nbsp;");$(document.body).insert(b);}return $(b);},post:function(){try{if(this.visible()){this.form().onsubmit();}}catch(a){jslog(a,"CommentWriter.post");}},discard:TBLite.remove,cleanup:function(){if(this.element){this.element=null;this.spacer().hide();var a=haikuCKEditorInstances("comment[body]");if(a){a.setData("");if(!IE){ckTrans();}a.destroy(true);}if(this.toEditId){$("<%= dom_id_base %>_col2_"+this.toEditId).show();}this.toEditId=null;this.list().select(".empty_column").each(Element.show);}},resize:function(){if(this.visible()){var b=this.maxWidth(),a=this.maxHeight(),c={};this.element.setStyle({width:b,height:a});b=parseInt(b,10);a=parseInt(a,10);c.width=b-(this.element.getWidth()-b)+"px";if(isNaN(a)){c.height="auto";}else{c.height=a-(this.element.getHeight()-a)+"px";}this.element.setStyle(c);}},maxWidth:function(){return TBLite.button.getWidth()+"px";},maxHeight:function(){var b=this.element,c=["Top","Bottom"].inject(0,function(e,d){return e+parseInt(b.getStyle("padding"+d),10);}),a=document.viewport.getHeight();return b.down().getHeight()+c<a?"auto":a+"px";}};CmsPageComments={element:function(){return $("page_comments_list");},list:function(){return $("cms_page_comments");},content:0,contentUrl:"",visible:function(){return this.list()&&this.list().visible();},toggle:function(b){try{if(this.list()){b=Object.extend({},b);switch(b.direction){case"expand":case"collapse":break;default:b.direction=this.visible()?"collapse":"expand";}if(this.visible()){if(b.direction=="collapse"){tgl(this.list(),"page_comments_tgl");}}else{if(b.direction=="expand"){switch(this.content){case 0:this.clearContent();tgl(this.list(),"page_comments_tgl",{fx:"none"});break;case 1:case 2:case 500:default:tgl(this.list(),"page_comments_tgl");}this.loadContent();}}}}catch(a){jslog(a,"CmsPageComments.toggle");}},loadContent:function(a){switch(this.content){case 0:if(Object.isUndefined(a)){a={};}Object.extend(a,{onComplete:this.afterLoadContent.bind(this)});ajax_post(this.contentUrl,"",a,"",this.list());this.content=1;break;}},afterLoadContent:function(){$(document).fire("haiku:grow_columns");this.list().setStyle({height:"auto"}).removeClassName("comments_loading");},clearContent:function(){if(this.list()){this.content=0;var a=this.list();a.setStyle({height:a.getHeight()+"px"}).addClassName("comments_loading").update($("page_comments_loading").innerHTML);if(a.getHeight()<a.childElements("div").inject(0,function(c,b){return c+b.getHeight();})){a.setStyle({height:a.childElements("div")[0].getHeight()+"px"});}$(document).fire("haiku:grow_columns");}},reloadContent:function(a){this.clearContent();this.loadContent(a);},setAltTip:function(a){var b=$("page_comments_alt_tip");a=$(a);if(b&&a){a.writeAttribute("atitle",b.innerHTML);}}};loadBoxes=function(){$$("div.unloaded").each(function(f){var d=f.id.replace("box_",""),b=f.viewportOffset().top,a=document.viewport.getScrollOffsets().top,c=document.viewport.getDimensions().height;if(c+a>b){f.removeClassName("unloaded");f.addClassName("lding");ajax_post(_renderContentUrl+d,"",{onSuccess:function(){f.removeClassName("lding");setTimeout(loadBoxes,1000);}},"ld"+d,"bbody"+d);}});};Event.observe(document.body,"haiku:viewport_resize",CommentWriter.resize.bind(CommentWriter));after_update_wikiproject=function(){TB_remove();ajax_post(_urlUpdateFeedBox.interpolate({type:"WikiProject"}));};resizable=function(b,e,f){b=$(b);e=$(e);f=Object.extend({},f);var a,c;var d=function(l){var j={x:(l.pointerX()-a.x),y:(l.pointerY()-a.y)},i=parseInt(b.getStyle("height"),10),g=parseInt(b.getStyle("width"),10),k={};a={x:l.pointerX(),y:l.pointerY()};if(!f.lockY){k.height=i+j.y+"px";}if(!f.lockX){k.width=g+j.x+"px";}b.setStyle(k);c.setStyle(k);};e.observe("mousedown",function(g){c=$("tmp_layer")||new Element("div",{id:"tmp_layer",style:"position:absolute;background:#eee;filter:alpha(opacity=50);opacity:0.5;"});e.insert({after:c});c.clonePosition(b);a={x:g.pointerX(),y:g.pointerY()};Event.observe(document.body,"mousemove",d);Event.stop(g);Event.observe(document.body,"mouseup",function(h){Event.stopObserving(document.body,"mousemove",d);Event.stopObserving(document.body,"mouseup");try{f.onComplete(b);}catch(i){}c.remove();});});};onBoxResize=function(a,b){ajax_post(_urlBoxUpdate.interpolate({id:b}),"",{parameters:{silent:1,"cms_box[minisite_embed_height]":a.getHeight()}});};msgInTrans=function(){MD_alert(_msgInTrans);};function grow_cms_page_columns(j,h,f){var i=function(p,q){p.style.height=q?q+"px":"";},m=function(p){return p.absoluteOffset()[1];},a=$("content"),e=$("col1"),b=h.collect(function(p){return $("col_"+j+"_"+p);});if(b.include(null)){b=[];}i(e);i(a);b.each(function(p){i(p);});if(f){return;}if(b.length>0){var l=b.collect(function(p){return p.getHeight();}).max();b.each(function(p){i(p,l);});}var o=$(document.body).getHeight(),d=document.viewport.getHeight(),n=e.getHeight();if(d>=o||d<n+m(e)){var k=a.getHeight(),c=o-k;i(a,[n,d-c,k].max());}i(e,a.getHeight()+m(a)-m(e));var g=$("cms_page_menubar");if(g&&document.viewport.getScrollOffsets().top==0){g.style.top="0px";}return false;}
/* END HAIKU LICENSE */