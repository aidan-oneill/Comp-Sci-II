/* BEGIN SBG LICENSE
*/
if(typeof SBG==="undefined"||SBG==null){SBG={};}SBG.Selector={};(function(){var d={};var e;SBG.Selector.initialize=function(h){e=h;};SBG.Selector.makeSelector=function(j,l,m,i,h){var k=$j("#"+j);k.select2({multiple:true,minimumInputLength:0,initSelection:function(n,o){o(l);},query:function(o){var p=new RegExp(o.term,"i");var n={results:(o.term?[]:m)};if(!o.term){o.callback(n);return;}g(o.term,function(q){n.results=n.results.concat(q);o.callback(n);});},createSearchChoice:function(n,p){if(p.length>0){return null;}if(e.mayCreateStandards){var o=a(k.select2("data"));return{id:o,text:n};}else{return null;}},formatResult:function(n){if(n.not_in_class){return e.translations.newToClassText+": "+n.text;}else{if(n.id<0){return e.translations.newStandardText+": "+n.text;}else{return n.text;}}},formatSelection:function(n){c();if(n.id<0){$(h).insert({top:new Element("input",{type:"hidden",id:i+n.id.toString(),name:i,value:n.text})});}return n.text;}});k.on("select2-focus",function(n){k.select2("open");});k.on("change",function(p){var q=function(){(p.val.length<=1)&&b();(p.removed.id<0)&&$(i+p.removed.id.toString()).remove();};var o=function(s){var r=k.select2("data");r.push(s);k.select2("data",r);};var n=function(t){var s=jQuery("#remove_standard_warning_template");var r=s.clone();r.removeClass("hidden-template");r.hide();r.find("[data-standard-selector-role='deleted-name-label']").text(t.text);r.find("[data-standard-selector-role='deleted-score-count']").text(t.scoreCount);r.find("[data-standard-selector-role='undo-standard-deletion']").click(function(){o(t);r.slideUp().remove();});s.before(r);r.slideDown();};if(p.removed){if(p.removed.scoreCount){n(p.removed);}q();}});};SBG.Selector.updateActivateSbgButton=function(i){try{if(JSON.parse(i.responseText)){$j("#standard_selector_activate_sbg a.sbutton").attr("class","btick sbutton disabled");$j("#standard_selector_activate_sbg a.sbutton").attr("onclick","null");setTimeout(function(){SBG.Selector.hideActivateSbgForever();},500);return;}}catch(h){console.log(h);}MD_alert(e.translations.cannotActivateText);};SBG.Selector.hideActivateSbgForever=function(){e.hideActivateSbGbook=true;b();};function g(h,i){$j.get(e.searchUrl,{keyword:h},function(j){i(f(j));});}function f(h){items=[];for(var j=0;j<h.length;j++){items.push({id:parseInt(h[j].id),text:h[j].name||h[j].description,not_in_class:!h[j].eclass_standard_id});}return items;}function c(){if(!e.hideActivateSbGbook){($j("#standard_selector_activate_sbg").length>0)&&$j("#standard_selector_activate_sbg").slideDown();}}function b(){($j("#standard_selector_activate_sbg").length>0)&&$j("#standard_selector_activate_sbg").slideUp();}var a=function(h){var i=0;h.each(function(j){if(j.id<i){i=j.id;}});return(i-1);};})();if(typeof SBG==="undefined"||SBG==null){SBG={};}SBG.ScoreInput={};(function(b){var a="sbscore_input";SBG.ScoreInput.makeScoreInput=function(s,E,k,H,A,v,C){var f=b("input[name="+s+"]"),m=f.prevAll("div.sbscore_indicator_box:first"),g=y(),i=null,B=null,w=false;f.setScoreInputType();f.keydown(function(N){if(F(N.which)){return;}z();});f.on("sbscoreSave",function(){w=true;z();});function z(){u();clearTimeout(B);B=setTimeout(h,800);}G();function p(){return b.isBlank(f.val())||j(y())||e(y());}function j(N){return b.isNumber(N)&&N>=C.min&&N<=C.max;}function J(N){var O=n(N);return O[0].entered_value;}function n(N){var O=N.toLowerCase();return jQuery.grep(C.levels,function(P){return P.short_name.toLowerCase().indexOf(O)===0;});}function e(O){if(typeof O!=="string"){return false;}var N=n(O);return N.length>0;}function u(){D("sbscore_saving");r("sbscore_saving");}function c(){D();r();}function t(){D("sbscore_invalid");r();}function d(){D();}function G(){r();if(b.isBlank(f.val())){}else{if(e(y())){I(J(y()));}else{I(y());}}}function I(N){if(N>=C.green_lower_cutoff){r("sbscore_green_level");}else{if(N>=C.yellow_lower_cutoff){r("sbscore_yellow_level");}else{r("sbscore_red_level");}}}function D(N){f.removeClass();f.addClass(a);if(N){f.addClass(N);}}function r(N){m.removeClass();m.addClass("sbscore_indicator_box");if(N){m.addClass(N);}}function o(){g=y();u();function O(){alert("Sorry, there was an error saving your scores. Please reload the page.");}if(i!=null){i.abort();i=null;}var N=function(P){if(P.success===0){O();}else{x();}i=null;};i=b.ajax({type:"POST",url:E,data:M(),success:N,headers:{Accept:"application/json"}}).fail(O);}function M(){return{standard_score:{gradable_type:k,gradable_id:H,standard_id:A,eclass_user_id:v,points:y()}};}function h(){if(q()){K();}else{if(!L()){x();}}w=false;}function q(){return g!==y();}function K(){if(p()){o();if(Grading.fillDown&&!w){f.confirmFillDown({onSave:function(N){b(N).trigger("sbscoreSave");}});}}else{t();}}function L(){return i!==null;}function x(){c();G();if(Grading.showGradeStatus){f.updateGradeStatus();}}function y(){if(b.isNumber(f.val())){return parseFloat(f.val());}else{return f.val();}}var l=[37,38,39,40,9,13,16];function F(N){return b.inArray(N,l)!=-1;}};})(jQuery);$j(function(){$j(document).on("mouseover",".sbg_single_student_grader_button",function(){var c=a(this);if(c.hasClass("uninitialized")){b(this,c);c.removeClass("uninitialized");}});function a(c){return $j(c).closest(".flyout_widget");}function b(c,f){var g=f.find(".sbg_single_student_grader_table")[0];var e=$j(g).dataTable({bAutoWidth:false,bFilter:false,bScrollCollapse:true,bLengthChange:false,bPaginate:false,bInfo:false,iDisplayLength:-1,bSort:false});var d=new KeyTable({table:g,datatable:e,initScroll:false});d.event.focus(null,null,function(j,h,l){var i=$j(j).children("input")[0];if(!i){var k=event.shiftKey;if(k){d.fnSetPosition(h+1,l-1);}else{d.fnSetPosition(h+1,l);}return;}i.focus();setTimeout(function(){i.select();},1);});d.event.action(null,null,function(i,h,j){d.fnSetPosition(h,j+1);});}});(function(a){a(document).on("click",".sbg_published_toggle",function(){SBG.triggerPublishGradebookAction().done(function(){window.location.reload();});});})(jQuery);var SBG=SBG||{};SBG.triggerPublishGradebookAction=function(){var b=window.gbURLs.publishGB;var a=jQuery.Deferred();TB_show(b);jQuery("#TB_window").data("promises",a);return a.promise();};SBG.setOverallGradePublished=function(a){var b=window.gbURLs.publishOverallGrade;return jQuery.post(b,{set_publish_overall:a?1:0}).promise();};SBG.triggerPublishOverallGrade=function(a){return SBG.setOverallGradePublished(true);};SBG.triggerUnpublishOverallGrade=function(a){return SBG.setOverallGradePublished(false);};SBG.updateGradebookPublishedIcon=function(b){var a=jQuery(".sbg_published_toggle");a.removeClass("published");a.removeClass("unpublished");if(b){a.addClass("published");}else{a.addClass("unpublished");}SBG.updateGradebookPublishedIconText(a,b);};SBG.updateGradebookPublishedIconText=function(b,a){jQuery(b).each(function(c,f){var d=jQuery(f),g=d.html();if(!g.length){return;}if(g.match(/unpub/i)){d.html("Publish Gradebook");}else{d.html("Unpublish Gradebook");}});};SBG.updateGradebookUnpublishedWarningCount=function(b){var a=jQuery(".sbg_gradebook_unpublished_count_warning");if(b===0){a.fadeOut();}else{a.fadeIn();if(b===1){a.text("There is 1 unpublished score.");}else{a.text("There are "+b+" unpublished scores.");}}};(function(b){b.fn.sbgScalePreview=function(c){return this.each(function(){a(b(this),c);});};function a(e,h){g();f();b("#scale_green_lower_cutoff_input").change(function(){h.green_lower_cutoff=b(this).val();c();});b("#scale_yellow_lower_cutoff_input").change(function(){h.yellow_lower_cutoff=b(this).val();c();});function g(){e.find(".sbg_scale_named_level_marker").each(function(){b(this).css({left:d(b(this).data("lowerCutoff")-h.min)+"%"});});}function d(i){return 100*(i)/(h.max-h.min);}function c(){if((h.max>h.green_lower_cutoff)&&(h.green_lower_cutoff>h.yellow_lower_cutoff&&h.yellow_lower_cutoff>h.min)){b(".scale_lower_cutoff_input").removeClass("sbg-scale-invalid");f();}else{b(".scale_lower_cutoff_input").addClass("sbg-scale-invalid");}}function f(){var k=d(h.yellow_lower_cutoff-h.min);var j=d(h.green_lower_cutoff-h.yellow_lower_cutoff);var i=d(h.max-h.green_lower_cutoff);e.find(".sbg_scale_red_section").css({width:k+"%"});e.find(".sbg_scale_yellow_section").css({width:j+"%"});e.find(".sbg_scale_green_section").css({width:i+"%"});}}})(jQuery);(function(a){a.fn.sbgScaleLevelDragger=function(){return this.each(function(){b(a(this));});};function b(f){var c=f.find("#level-container");var e=f.find("#sbg-scale-level-template").text();c.sortable({containment:"parent",cursor:"move",update:function(){d();}});f.on("click",".bdelete",function(){a(this).closest("div").remove();});f.find("#level-dragger-add-level-button").click(function(){c.append(e);d();});function d(){c.find("div.sbg_scale_level").each(function(h,g){a(g).find('[name*="scale[levels]"]').each(function(j,m){var k=a(m);var l=k.attr("name");var i=l.replace(/(scale\[levels\])\[(\d*)\](.*)/,function(q,p,o,n){return p+"["+h+"]"+n;});k.attr("name",i);});});}}})(jQuery);(function(a){a.fn.sbgScaleLevelDefiner=function(c){return this.each(function(){b(a(this),c);});};function b(d,f){d.on("change",".sbg-scale-level-lower-cutoff",h);d.on("change",".sbg-scale-level-short-name",c);h();c();function h(){var i=+f.max+0.0001;d.find(".sbg-scale-level-lower-cutoff").each(function(j,k){var l=a(k).val();if(!a.isNumber(l)||+l>=+i||+l<f.min){g(k);}else{e(k);i=l;}});}function c(){var i=[];d.find(".sbg-scale-level-short-name").each(function(j,k){var l=a(k).val().toLowerCase().trim();if(i.indexOf(l)===-1||a.isBlank(l)){i.push(l);e(k);}else{g(k);}});}function g(i){a(i).addClass("sbg-scale-invalid");}function e(i){a(i).removeClass("sbg-scale-invalid");}}})(jQuery);window.SBG=window.SBG||{};window.SBG.scaleEditorUtil={};(function(a){var b=window.SBG.scaleEditorUtil;b.submitForm=function(d,c){var e=a("#tb_sbg_scale_step_form");if(f()){a.post(d,e.serialize(),function(g){TB_remove_actionBar();a("#TB_ajaxContent").html(g);TB_add_actionBar();});}else{MD_alert(c.correctError);}function f(){return e.find(".sbg-scale-invalid").length===0;}};b.submitFormAfterConfirmation=function(d,c){MD_confirm("<div class='note'>"+c.updateWarning+"</div>",{buttons:[[c.updateAction,function(){b.submitForm(d,c);}],[c.cancelAction]]});};})(jQuery);
/* END SBG LICENSE */